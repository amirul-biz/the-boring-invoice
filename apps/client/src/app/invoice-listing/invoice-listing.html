<div class="container py-4">
  <ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="large" color="#fff" type="ball-scale-multiple" [fullScreen]="true">
    <p style="color: white">Loading...</p>
  </ngx-spinner>

  <h2 class="mb-4">Invoice Listing</h2>

  <div class="row mb-4">
    <div class="col-12 col-md-3">
      <div class="card">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">Pending Amount</h6>
          <h3 class="card-title mb-1">MYR {{ summary.pendingAmount | number:'1.2-2' }}</h3>
          <small class="text-muted">{{ summary.pendingCount }} invoice(s)</small>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-3 mt-3 mt-md-0">
      <div class="card">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">Total Paid</h6>
          <h3 class="card-title mb-1 text-success">MYR {{ summary.totalPaid | number:'1.2-2' }}</h3>
          <small class="text-muted">{{ summary.paidCount }} invoice(s)</small>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-3 mt-3 mt-md-0">
      <div class="card">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">Total Invoices</h6>
          <h3 class="card-title mb-1">{{ totalItems }}</h3>
          <small class="text-muted">All statuses</small>
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <div class="row g-3 align-items-end" [formGroup]="filterForm">
        <div class="col-6 col-md-2">
          <label class="form-label">Page Size</label>
          <select class="form-select" formControlName="pageSize">
            @for (size of pageSizes; track size) {
              <option [ngValue]="size">{{ size }}</option>
            }
          </select>
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label">Date From</label>
          <input type="date" class="form-control" formControlName="dateFrom">
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label">Date To</label>
          <input type="date" class="form-control" formControlName="dateTo">
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label">Invoice Type</label>
          <select class="form-select" formControlName="invoiceType">
            <option [ngValue]="null">All</option>
            @for (type of invoiceTypes; track type.value) {
              <option [ngValue]="type.value">{{ type.label }}</option>
            }
          </select>
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label">Status</label>
          <select class="form-select" formControlName="status">
            <option [ngValue]="null">All</option>
            @for (s of invoiceStatuses; track s.value) {
              <option [ngValue]="s.value">{{ s.label }}</option>
            }
          </select>
        </div>

        <div class="col-6 col-md-1">
          <button type="button" class="btn btn-primary w-100" (click)="onSearch()">Search</button>
        </div>
        <div class="col-6 col-md-1">
          <button type="button" class="btn btn-outline-secondary w-100" (click)="onReset()">Reset</button>
        </div>
      </div>
    </div>
  </div>

  <app-invoice-listing-table
    [invoices]="invoices"
    [page]="page"
    [pageSize]="filterForm.controls.pageSize.value"
    [totalItems]="totalItems"
    (pageChange)="onPageChange($event)"
    (action)="onAction($event)" />
</div>
